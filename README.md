# PayloadCMS + Guardz-Generator Integration Demo

This demo shows how PayloadCMS can integrate guardz-generator to add runtime type validation to their generated types.

## What This Demo Shows

1. **Automatic Type Guard Generation**: How guardz-generator creates runtime validation functions from PayloadCMS's generated types
2. **Runtime Type Safety**: How to validate API responses, form data, and user input
3. **Zero Configuration**: How easy it is to integrate with existing PayloadCMS workflows
4. **Production Ready**: How the generated guards work in real-world scenarios

## Quick Start

```bash
# Install dependencies
npm install

# Generate type guards from PayloadCMS types
npm run generate:guards

# Run the integration test
npm test
```

## How It Works

### 1. PayloadCMS Generates Types
```typescript
// payload-types.ts (auto-generated by PayloadCMS)
export interface User {
  id: string;
  email: string;
  roles: ('admin' | 'editor' | 'user')[];
  // ... more fields
}
```

### 2. Guardz-Generator Creates Runtime Guards
```typescript
// isUser.guardz.ts (auto-generated by guardz-generator)
import { isString, isArrayWithEachItem, isOneOf, isType } from 'guardz';

export const isUser = (value: unknown): value is User => {
  return isType(value, {
    id: isString,
    email: isString,
    roles: isArrayWithEachItem(isOneOf(['admin', 'editor', 'user'])),
    // ... validates all fields
  });
};
```

### 3. Use Runtime Validation
```typescript
// API endpoint validation
import { isUser } from './payload-types/isUser.guardz';

export const validateUserData = (data: unknown) => {
  if (isUser(data)) {
    return data; // Type-safe access
  }
  throw new Error('Invalid user data');
};
```

## Benefits for PayloadCMS

### ✅ **Runtime Type Safety**
- Validate API responses before processing
- Ensure form data integrity
- Catch type errors at runtime

### ✅ **Better Developer Experience**
- Type-safe data handling
- Clear validation errors
- IntelliSense support for validated data

### ✅ **API Reliability**
- Validate incoming requests
- Ensure data consistency
- Prevent runtime errors

### ✅ **Frontend Integration**
- Type-safe React/Vue components
- Form validation
- API response handling

## Integration Steps for PayloadCMS

### 1. Add Dependencies
```bash
npm install guardz-generator guardz
```

### 2. Update Build Process
```json
{
  "scripts": {
    "generate:types": "payload generate:types",
    "generate:guards": "guardz-generator generate payload-types.ts",
    "build": "npm run generate:types && npm run generate:guards"
  }
}
```

### 3. Add Configuration
```typescript
// guardz.generator.config.ts
export default {
  includes: ['payload-types.ts'],
  excludes: ['**/*.guardz.ts'],
  postProcess: true,
};
```

### 4. Use in Code
```typescript
// API validation
import { isUser } from './payload-types/isUser.guardz';

app.post('/api/users', (req, res) => {
  if (isUser(req.body)) {
    // Process valid user data
    return res.json({ success: true });
  }
  return res.status(400).json({ error: 'Invalid user data' });
});
```

## Real-World Use Cases

### 1. **API Endpoint Validation**
```typescript
// Validate incoming API requests
app.post('/api/posts', (req, res) => {
  if (isPost(req.body)) {
    // Type-safe access to post data
    const { title, content, author } = req.body;
    // Process post...
  }
});
```

### 2. **Form Validation**
```typescript
// Frontend form validation
const validateUserForm = (formData: unknown) => {
  if (isUser(formData)) {
    return { valid: true, data: formData };
  }
  return { valid: false, errors: ['Invalid form data'] };
};
```

### 3. **Database Response Validation**
```typescript
// Validate database responses
const getUser = async (id: string) => {
  const user = await db.users.findById(id);
  
  if (isUser(user)) {
    return user; // Type-safe
  }
  
  throw new Error('Invalid user data from database');
};
```

## Performance Impact

- **Bundle Size**: ~15KB gzipped for guardz library
- **Runtime Performance**: Minimal overhead (microseconds per validation)
- **Build Time**: ~1-2 seconds additional for type guard generation

## Migration Strategy

### Phase 1: Optional Integration
- Add guardz-generator as optional dependency
- Generate guards alongside existing types
- Document usage for interested users

### Phase 2: Recommended Integration
- Include in official PayloadCMS templates
- Add to documentation and examples
- Provide migration guides

### Phase 3: Default Integration
- Include by default in new projects
- Add to core PayloadCMS features
- Provide configuration options

## Conclusion

This integration would significantly enhance PayloadCMS's type safety capabilities while maintaining zero breaking changes. The benefits include:

- **Runtime type safety** for all PayloadCMS types
- **Better developer experience** with type-safe data handling
- **Improved API reliability** with automatic validation
- **Easy integration** with existing PayloadCMS workflows

The integration is straightforward, well-tested, and provides immediate value to PayloadCMS users. 